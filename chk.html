<!DOCTYPE html>
<html>
<head>
    <title>체크리스트</title>
</head>
<body>
    <div class="content">
        <h3>실행 전, 몇 가지 확인 사항이 있습니다...</h3>
        <div class="spinner"></div>
    </div>

    <!-- 1. 크롬 브라우저 설치 확인 -->
    <div class="check-container">
        <h5 class="chk_1">1. 크롬 브라우저 설치 확인</h5>
        <span class="checkmark_1">✔</span>
    </div>
    <div id="message-chk1"></div>

    <!-- 2. 경매올리고 ID/PW 등록 확인 -->
    <div class="check-container">
        <h5 class="chk_2">2. 경매올리고 ID/PW 등록 확인</h5>
        <span class="checkmark_2">✔</span>
    </div>
    <div class="login-form" style="display: none;">
        <div class="input-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="input-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button class="a_button" id="set_auction">계정 설정</button>
    </div>
    <div id="message-chk2"></div>

    <!-- 3. 블로그 시작 이미지 폴더 경로 설정 확인 -->
    <div class="check-container">
        <h5 class="chk_3">3. 블로그 시작 이미지 폴더 경로 설정 확인</h5>
        <span class="checkmark_3">✔</span>
    </div>
    <div style="margin-bottom: 5px;">
        <button class="b_button" id="set_path_start">시작 이미지 폴더 설정</button>
    </div>
    <div id="message-chk3"></div>

    <!-- 4. 블로그 마무리 이미지 폴더 경로 설정 확인 -->
    <div class="check-container">
        <h5 class="chk_4">4. 블로그 마무리 이미지 폴더 경로 설정 확인</h5>
        <span class="checkmark_4">✔</span>
    </div>
    <div style="margin-bottom: 5px;">
        <button class="b_button" id="set_path_end">마무리 이미지 폴더 설정</button>
    </div>
    <div id="message-chk4"></div>

    <!-- 5. 전화번호 등록 확인 -->
    <div class="check-container">
        <h5 class="chk_5">5. 전화번호 등록 확인</h5>
        <span class="checkmark_5">✔</span>
    </div>
    <div class="phone-input-container">
        <input type="tel" id="phone" placeholder="010-0000-0000">
        <button class="c-button" id="set_phone" disabled>변경</button>
        <!-- <span id="phone-feedback"></span> -->
    </div>
    <div id="message-chk5"></div>
    
    <!-- 6. 실행 -->
    <div style="margin-top: 20px;">
        <button id="run_session">프로세스 실행</button>
    </div>

    <script>
        /* ipcRenderer 를 직접 노출하는 경우, 비활성화 권장 */
        const { ipcRenderer } = require('electron');

        window.addEventListener('DOMContentLoaded', async () => {

            await waitForTimeout(2000);

            // 1. 크롬 브라우저 설치 확인
            await chkChrome();

            // 2. 경매올리고 로그인 테스트
            await chkAuction();

            // 3. 이미지 경로 확인
            await chkPathStart();

            // 4. 이미지 경로 확인
            await chkPathEnd();

             // 3. 전화번호 등록 확인
            await chkPhone();
        });

        /* 1. 크롬 브라우저 설치 관련 */
        const chkChrome = () => {
            ipcRenderer.send('chk-chrome');
        }

        ipcRenderer.on('message-chk1', function(event, data) {
            let message = document.getElementById('message-chk1');
            message.innerHTML = data.text;
            if (data.result) {
                let checkmark = document.querySelector('.checkmark_1');
                checkmark.classList.add('visible');

                let chk_1 = document.querySelector('.chk_1');
                chk_1.classList.add('check');
            }
        });

        /* 2. 경매올리고 로그인 테스트 관련 */
        const chkAuction = () => {
            ipcRenderer.send('chk-auction');
        }

        ipcRenderer.on('message-chk2', function(event, data) {
            let message = document.getElementById('message-chk2');
            message.innerHTML = data.text;
            if (data.result === 11) { // 등록한 계정 검사
                document.getElementById('set_auction').disabled = true;

                // alert('계정이 등록되었습니다.');
                // let inputForm = document.querySelector('.login-form').style.display = 'none';

            } else if (data.result === 33) { // 등록한 계정이 유효한지 확인

            } else if (data.result === 44) {
                let inputForm = document.querySelector('.login-form').style.display = 'block';
                document.getElementById('set_auction').disabled = false;

            } else if (data.result === 55) { // 계정 유효 확인, 잔여일 알림
                let inputForm = document.querySelector('.login-form').style.display = 'none';
                document.getElementById('set_auction').disabled = false;

                let checkmark2 = document.querySelector('.checkmark_2');
                checkmark2.classList.add('visible');
                
                let chk_2 = document.querySelector('.chk_2');
                chk_2.classList.add('check');
            } 
            else if (!data.result) { // false 응답이 올 경우 ID/PW 입력폼 보이기
                let inputForm = document.querySelector('.login-form').style.display = 'block';
            }
        });

        document.getElementById('set_auction').addEventListener('click', async () => { // 버튼에 클릭 이벤트 리스너 추가   
            try {
                const id = document.querySelector('#username').value;
                const pw = document.querySelector('#password').value;
                ipcRenderer.send('set_auction', { id: id, pw:pw }); // 메인 프로세스에 'set_auction' 메시지 전송

            } catch (error) {
                console.log(error);
            }
        });

        /* 3. 이미지 경로 설정 관련 */
        const chkPathStart = () => {
            ipcRenderer.send('chk_path_start');
        }

        document.getElementById('set_path_start').addEventListener('click', async () => { // 버튼에 클릭 이벤트 리스너 추가   
            try {
                ipcRenderer.send('set_path_start'); // 메인 프로세스에 'set_path_start' 메시지 전송  

            } catch (error) {
                console.log(error);
            }
        });

        ipcRenderer.on('message-chk3', function(event, data) {
            let message = document.getElementById('message-chk3');
            message.innerHTML = data.text;
            if (data.result) {
                let checkmark = document.querySelector('.checkmark_3');
                checkmark.classList.add('visible');

                let chk_3 = document.querySelector('.chk_3');
                chk_3.classList.add('check');
            }
        });

        /* 4. 이미지 경로 설정 관련 */
        const chkPathEnd = () => {
            ipcRenderer.send('chk_path_end');
        }

        document.getElementById('set_path_end').addEventListener('click', async () => { // 버튼에 클릭 이벤트 리스너 추가   
            try {
                ipcRenderer.send('set_path_end'); // 메인 프로세스에 'set_path_end' 메시지 전송  

            } catch (error) {
                console.log(error);
            }
        });

        ipcRenderer.on('message-chk4', function(event, data) {
            let message = document.getElementById('message-chk4');
            message.innerHTML = data.text;
            if (data.result) {
                let checkmark = document.querySelector('.checkmark_4');
                checkmark.classList.add('visible');

                let chk_4 = document.querySelector('.chk_4');
                chk_4.classList.add('check');
            }
        });

        /* 5. 전화번호 등록 관련 */
        const chkPhone = () => {
            ipcRenderer.send('chk_phone');
        }

        ipcRenderer.on('message-chk5', function(event, data) {
            let message = document.getElementById('message-chk5');
            message.innerHTML = data.text;
            if (data.result) {
                let checkmark = document.querySelector('.checkmark_5');
                checkmark.classList.add('visible');

                let chk_5 = document.querySelector('.chk_5');
                chk_5.classList.add('check');
            }
        });

        document.getElementById('phone').addEventListener('input', function (event) {
            let input = event.target.value.replace(/\D/g, '');
            let formattedInput = '';
            
            // 숫자만 추출하여 형식에 맞게 포맷
            if (input.length > 3) {
                formattedInput += input.substr(0, 3) + '-';
                if (input.length > 7) {
                    formattedInput += input.substr(3, 4) + '-';
                    formattedInput += input.substr(7);
                } else {
                    formattedInput += input.substr(3);
                }
            } else {
                formattedInput = input;
            }
            
            event.target.value = formattedInput;

            // 유효성 검사
            let button = document.getElementById('set_phone');

            if (formattedInput.match(/^\d{3}-\d{4}-\d{4}$/)) {
                event.target.className = 'valid';
                // document.getElementById('phone-feedback').textContent = '올바른 형식입니다!';
                button.disabled = false;  // 버튼 활성화
            } else {
                event.target.className = 'invalid';
                // document.getElementById('phone-feedback').textContent = '올바른 전화번호 형식을 입력해주세요.';
                button.disabled = true;   // 버튼 비활성화
            }
        });

        document.getElementById('set_phone').addEventListener('click', async () => { // 버튼에 클릭 이벤트 리스너 추가   
            try {
                const phone = document.querySelector('#phone').value;
                ipcRenderer.send('set_phone', { phone: phone });

            } catch (error) {
                console.log(error);
            }
        });

        /* 프로그램 실행 관련 */
        document.getElementById('run_session').addEventListener('click', async () => { // 버튼에 클릭 이벤트 리스너 추가   
            try {
                ipcRenderer.send('run_session'); // 메인 프로세스에 'run_session' 메시지 전송  

            } catch (error) {
                console.log(error);
            }
        });

        const waitForTimeout = (ms) => {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

    </script>
</body>
<style>
    
    body {
        font-family: 'Arial', sans-serif;
        background-color: #fff;
        color: #333;
        padding: 20px;
        margin: 0;
    }
        
    button {
        background-color: #3b4657;
        color: white;
        border: none;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.3s;
    }

    button:hover {
        background-color: #142135;
    }

    .content {
        display: flex; /* Flexbox 레이아웃 적용 */
        align-items: center; /* 세로 중앙 정렬 */
    }

    .spinner {
        margin-left: 20px;
        margin-right: 20px;
        border: 4px solid rgba(0, 0, 0, 0.1); /* 바깥쪽 원의 테두리 색상 (반투명) */
        border-left-color: #3b4657; /* 왼쪽 테두리 색상 (회전하는 효과를 위해) */
        border-radius: 50%; /* 원형 스피너 */
        width: 16px; /* 스피너 크기 */
        height: 16px; /* 스피너 크기 */
        animation: spin 2.0s linear infinite; /* 회전 애니메이션 */
    }

    /* keyframes를 사용한 회전 애니메이션 정의 */
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(360deg);
        }
    }
    
    h1 {
        color: #3b4657;
    }

    h2 {
        color: #3b4657;
    }

    h3 {
        color: #3b4657;
    }

    h4 {
        color: #3b4657;
    }

    /* h5 {
        color: #3b4657;
    } */
    
    .flex-container {
        display: flex;
        align-items: center;
        font-size: 13px;
    }
    
    .flex-container > div {
        margin-right: 5px;
    }
    
    .check-container {
        display: flex;
        align-items: center;
    }

    .chk_1 {
        color: #a1abbb;
    }

    .chk_1.check {
        color: #3b4657;
        animation: fadeIn 1.2s ease forwards;
    }

    .checkmark_1 {
        display: none;
    }

    .checkmark_1.visible {
        display: inline;
        color: #32cd32;
        opacity: 0;
        margin-left: 10px;
        animation: fadeInCheck 2s forwards;
    }

    #message-chk1 {
        margin-top: 0px;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 12px;
    }

    .chk_2 {
        color: #a1abbb;
    }

    .chk_2.check {
        color: #3b4657;
        animation: fadeIn 1.2s ease forwards;
    }

    .checkmark_2 {
        display: none;
    }

    .checkmark_2.visible {
        display: inline;
        color: #32cd32;
        opacity: 0;
        margin-left: 10px;
        animation: fadeInCheck 2s forwards;
    }

    #message-chk2 {
        margin-top: 0px;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 12px;
    }

    .login-form {
        background: white;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .input-group label {
        display: block;
        margin-bottom: 5px;
        color: #666;
    }

    .input-group input {
        width: 300px;
        padding: 10px;
        margin-bottom: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .a_button {
        width: 320px;
        padding: 10px;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
    }

    .a_button:hover {
        background-color: #0056b3;
    }

    .a_button:disabled { /* 비활성화 상태일 때의 스타일 */
        background-color: #aaa; /* 밝은 회색으로 변경 */
        color: #666; /* 어두운 회색으로 글자 색 변경 */
        cursor: not-allowed; /* 커서를 '금지' 아이콘으로 변경 */
    }

    .chk_3 {
        color: #a1abbb;
    }

    .chk_3.check {
        color: #3b4657;
        animation: fadeIn 1.2s ease forwards;
    }

    .checkmark_3 {
        display: none;
    }

    .checkmark_3.visible {
        display: inline;
        color: #32cd32;
        opacity: 0;
        margin-left: 10px;
        animation: fadeInCheck 2s forwards;
    }

    #message-chk3 {
        margin-top: 0px;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 12px;
    }

    .chk_4 {
        color: #a1abbb;
    }

    .chk_4.check {
        color: #3b4657;
        animation: fadeIn 1.2s ease forwards;
    }

    .checkmark_4 {
        display: none;
    }

    .checkmark_4.visible {
        display: inline;
        color: #32cd32;
        opacity: 0;
        margin-left: 10px;
        animation: fadeInCheck 2s forwards;
    }

    #message-chk4 {
        margin-top: 0px;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 12px;
    }

    .chk_5 {
        color: #a1abbb;
    }

    .chk_5.check {
        color: #3b4657;
        animation: fadeIn 1.2s ease forwards;
    }

    .checkmark_5 {
        display: none;
    }

    .checkmark_5.visible {
        display: inline;
        color: #32cd32;
        opacity: 0;
        margin-left: 10px;
        animation: fadeInCheck 2s forwards;
    }

    #message-chk5 {
        margin-top: 0px;
        padding: 10px;
        background-color: #e9ecef;
        border-radius: 8px;
        font-size: 12px;
    }

    .phone-input-container {
        margin: 5px;
        font-family: Arial, sans-serif;
        display: flex;
    }

    input[type="tel"] {
        padding: 8px;
        margin: 4px;
        border: 2px solid gray;
        border-radius: 4px;
        width: 200px;
    }

    input[type="tel"]:focus {
        border-color: blue;
    }

    input[type="tel"].valid {
        border-color: green;
    }

    input[type="tel"].invalid {
        border-color: red;
    }

    #phone-feedback {
        color: red;
        font-size: 0.8em;
    }

    .b_button {
        padding: 3px 10px 3px 10px;
        border: none;
        border-radius: 4px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        font-size: 11px;
    }

    .b_button:hover {
        background-color: #0056b3;
    }

    .c-button {
        background-color: #fff;
        color: #142135;
        border: none;
        padding: 8px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 14px;
        margin: 4px 2px;
        cursor: pointer;
        border: 1px solid;
        border-radius: 8px;
        transition: background-color 0.3s;
    }

    .c-button:hover {
        background-color: #3b4657;
        color: #ffffff;
    }

    button.c-button:disabled {
        background-color: #cccccc;
        color: #555555;
        cursor: default;
    }

    @keyframes fadeInCheck {
        0% {
            opacity: 0;
            transform: scale(0);
        }
        50% {
            opacity: 0.5;
            transform: scale(1.2);
        }
        100% {
            opacity: 1;
            transform: scale(1);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }

</style>
</html>